# FastAPI Knowledge Base Application

This repository contains a FastAPI application that allows users to interact with a knowledge base system. It supports features such as creating, deleting, and querying knowledge bases, as well as uploading documents (PDFs) to the knowledge base. The application utilizes Chroma for document storage and retrieval and Google Generative AI to answer user queries based on the knowledge base content.

## Features

- **Status Endpoint**: Provides a simple status check to confirm the application is running.
- **Knowledge Base Management**: 
  - List existing knowledge bases.
  - Create new knowledge bases.
  - Delete knowledge bases.
- **Document Upload**: Upload PDF documents, extract the text, remove stopwords, chunk the text, and store it into the knowledge base.
- **Query Handling**: Query a knowledge base using a text input, and receive a formal response generated by the Google Generative AI model based on the stored knowledge.

## Requirements

- Python 3.7 or higher
- FastAPI
- Uvicorn (for serving FastAPI)
- Google Generative AI SDK (`google-generativeai`)
- Chroma DB (for storing and querying knowledge base)
- Gensim (for stopword removal and text processing)
- pypdf (for extracting text from PDFs)

## Installation

### 1. Clone the repository:

```bash
git clone https://github.com/your-username/knowledge-base-fastapi.git
cd knowledge-base-fastapi
```

### 2. Create a virtual environment (optional but recommended):

```bash
python -m venv venv
source venv/bin/activate  # For Linux/macOS
venv\Scripts\activate     # For Windows
```

### 3. Install dependencies:

```bash
pip install -r requirements.txt
```

## Usage

### 1. Run the FastAPI server

```bash
uvicorn main:app --reload
```

This will start the FastAPI application on `http://127.0.0.1:8000`.

### 2. Available Endpoints

#### `GET /status`

Checks if the application is running.

**Response:**

```json
{
    "status": "it works"
}
```

#### `GET /knowledge_bases/`

Lists all existing knowledge bases.

**Response:**

```json
{
    "list of knowledge bases": ["kb1", "kb2", "kb3"]
}
```

#### `DELETE /knowledge_base/{kb_id}`

Deletes the knowledge base with the given ID.

**Parameters:**
- `kb_id` (str): The ID of the knowledge base to delete.

**Response:**

```json
{
    "message": "{kb_id} deleted successfully"
}
```

#### `POST /create_knowledge_base/{kb_id}`

Creates a new knowledge base with the given ID.

**Parameters:**
- `kb_id` (str): The ID of the new knowledge base.

**Response:**

```json
{
    "message": "new knowledge base is successfully created"
}
```

#### `POST /add_document_to_knowledge_base/{kb_id}`

Uploads a PDF document, extracts its text, processes it, and stores it in the knowledge base.

**Parameters:**
- `kb_id` (str): The ID of the knowledge base to store the document in.
- `file` (file): The PDF document to upload.

**Response:**

```json
{
    "message": "pdf is successfully chunked and stored into {kb_id}"
}
```

If the file is not a PDF:

```json
{
    "message": "we support only pdfs"
}
```

#### `POST /query/{kb_id}`

Queries the knowledge base with a text input and generates a formal response using the Google Generative AI model.

**Parameters:**
- `kb_id` (str): The ID of the knowledge base to query.
- `query` (str): The query text to process.

**Response:**

```json
{
    "result": "Generated response text based on the knowledge base content."
}
```

If an error occurs while retrieving data from ChromaDB:

```json
{
    "message": "I couldn't retrieve data from chromadb {error_message}"
}
```

## Error Handling

- **General errors**: Any errors occurring during the interaction with Chroma or the Google Generative AI model are caught and returned with a message indicating the error.
  
- **File upload validation**: Only PDF files are supported. If a non-PDF file is uploaded, the response will indicate that only PDFs are supported.

## Configuration

To configure the application:

- **Google Generative AI API Key**: The application uses the Google Generative AI SDK. You need to replace the API key in the `query` endpoint where `genai.configure(api_key="YOUR_API_KEY")` is called.
  
  You can get your API key from the Google Cloud console after enabling the Generative AI API.

- **Chroma**: The `ChromaProcessing` class handles the interaction with the Chroma database. Ensure you have the necessary configurations set up for your Chroma client (e.g., database URL, authentication credentials, etc.).

## Contributing

Contributions are welcome! If you'd like to contribute, please fork the repository, create a branch, and submit a pull request.

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Acknowledgments

- [FastAPI](https://fastapi.tiangolo.com/) for creating a fast, easy-to-use web framework.
- [Google Generative AI](https://cloud.google.com/ai) for providing the AI model used to generate responses.
- [Chroma](https://www.trychroma.com/) for providing an open-source vector database to store and query knowledge.
- [Gensim](https://radimrehurek.com/gensim/) for providing the stopwords removal functionality.